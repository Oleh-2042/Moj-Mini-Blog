<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameDev Blog - Oleg</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
</head>
<body>
<div class="container">
    <h1>M√≥j Mini Blog</h1>

    <div style="background: #ffebee; padding: 15px; margin-bottom: 20px;">
        <h3>Dodaj nowy artyku≈Ç</h3>
        <input type="text" id="newTitle" placeholder="Tytu≈Ç artyku≈Çu">
        <input type="text" id="newAuthor" placeholder="Twoje imiƒô i nazwisko">
        <textarea id="newContent" placeholder="Tre≈õƒá (mo≈ºesz u≈ºywaƒá tagu <pre> dla kodu)..."></textarea>
        <button class="btn" onclick="addArticle()">Opublikuj</button>
    </div>

    <div id="articlesList">
        <p>≈Åadowanie artyku≈Ç√≥w...</p>
    </div>
</div>

<script>
    const API_URL = 'api.php';

    // –§—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —á–∞—Å—É —á–∏—Ç–∞–Ω–Ω—è (–∑–∞–ª–∏—à–∞—î–º–æ, –±–æ —Ü–µ –∫—Ä—É—Ç–æ –≤–∏–≥–ª—è–¥–∞—î)
    function calculateReadingTime(text) {
        const words = text.split(/\s+/).length;
        return Math.ceil(words / 200);
    }

    async function loadArticles() {
        try {
            const res = await fetch(API_URL + '?action=get_articles');
            const articles = await res.json();
            const list = document.getElementById('articlesList');
            list.innerHTML = '';

            if (articles.length === 0) {
                list.innerHTML = '<p>Brak artyku≈Ç√≥w. Dodaj pierwszy wpis!</p>';
                return;
            }

            articles.forEach(article => {
                const date = new Date(Number(article.id) * 1000).toLocaleDateString('pl-PL');
                const readTime = calculateReadingTime(article.content);

                const div = document.createElement('div');
                div.className = 'article-card';

                div.innerHTML = `
                    <h3><a href="article.html?id=${article.id}">${article.title}</a></h3>
                    <p>${article.content.substring(0, 150)}...</p>
                    <small>
                        Autor: <strong style="color: #d4af37">${article.author}</strong> |
                        üìÖ ${date} | ‚è±Ô∏è Czas czytania: ${readTime} min
                    </small>
                    <br>
                    <a href="article.html?id=${article.id}" class="btn" style="font-size: 12px;">Czytaj dalej</a>
                `;
                list.appendChild(div);
            });
        } catch (error) {
            console.error("B≈ÇƒÖd:", error);
            document.getElementById('articlesList').innerHTML = "<p>B≈ÇƒÖd ≈Çadowania danych.</p>";
        }
    }

    async function addArticle() {
        const title = document.getElementById('newTitle').value;
        const author = document.getElementById('newAuthor').value;
        const content = document.getElementById('newContent').value;

        if(!title || !content) return alert("Wype≈Çnij wszystkie pola!");

        await fetch(API_URL + '?action=add_article', {
            method: 'POST',
            body: JSON.stringify({ title, author, content })
        });

        document.getElementById('newTitle').value = '';
        document.getElementById('newContent').value = '';
        loadArticles();
    }

    loadArticles();
</script>

<footer style="text-align: center; margin-top: 50px; padding: 20px; border-top: 1px solid #333; color: #666; font-size: 0.9em;">
    <p>&copy; 2025 Oleh admin Blog.</p>
</footer>
</body>
</html>